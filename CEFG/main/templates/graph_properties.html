{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="wrap">
    <div class="paper">
        <h1 class="section-title">Graph #{{ graph.id }} Properties</h1>
        <p class="lead">Text: <strong>{{ graph.text }}</strong></p>

        <div class="graph-area">
            <svg id="svg"></svg>
            <div class="legend">
                <span class="chip">Sentence</span>
                <span class="chip">Entity</span>
            </div>
        </div>

        <section style="margin-top:20px">
            <h2 class="section-title">Graph Details</h2>
            <h3 style="font-size:16px;margin-top:12px">Nodes</h3>
            {% for node in nodes %}
                <div style="padding:8px;border-bottom:1px solid #f0f0f0">
                    <strong>{{ node.id }}</strong> — Type: {{ node.type }}
                    {% if node.text %}<br><em>{{ node.text }}</em>{% endif %}
                </div>
            {% empty %}
                <p>No nodes found.</p>
            {% endfor %}

            <h3 style="font-size:16px;margin-top:20px">Edges</h3>
            {% for edge in edges %}
                <div style="padding:8px;border-bottom:1px solid #f0f0f0">
                    <strong>Edge {{ edge.id }}:</strong> {{ edge.from_node.id }} → {{ edge.to_node.id }} (Weight: {{ edge.weight }})
                </div>
            {% empty %}
                <p>No edges found.</p>
            {% endfor %}
        </section>

        <div style="margin-top:20px">
            <a href="{% url 'main:graphs_list' %}" style="color:var(--accent);text-decoration:none">← Back to graphs list</a>
        </div>
    </div>
</div>

<!-- Hidden div to pass graph data from Django to JavaScript -->
<div id="graph-data" 
     data-nodes='[
        {"id": "sentence", "type": "sentence", "label": "Sentence", "text": null}
        {% for node in nodes %}
        ,{"id": "{{ node.id }}", "type": "{{ node.type }}", "text": "{{ node.text|escapejs }}"}
        {% endfor %}
     ]'
     data-edges='[
        {% for edge in edges %}
        {"source": "{{ edge.from_node.id }}", "target": "{{ edge.to_node.id }}"}{% if not forloop.last %},{% endif %}
        {% endfor %}
     ]'
     style="display:none">
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/nlpgraph.js' %}"></script>
<script src="{% static 'js/graph_detail.js' %}"></script>
{% endblock %}