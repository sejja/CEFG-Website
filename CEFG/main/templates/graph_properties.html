{% extends 'base.html' %}
{% load static %}

{% block title %}Graph #{{ graph.id }} Properties — CEFG{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'styles/graph_properties.css' %}">
{% endblock %}

{% block content %}
<div class="wrap">
    <div class="paper">
        <h1 class="section-title">Graph #{{ graph.id }} Properties</h1>
        <p class="lead">Text: <strong>{{ graph.text }}</strong></p>

        <div class="graph-area">
            <svg id="svg"></svg>
            <div class="legend">
                <span class="chip">Sentence</span>
                <span class="chip">Entity</span>
            </div>
        </div>

        <section class="graph-details-section">
            <h2 class="section-title">Graph Details</h2>
            <h3>Nodes</h3>
            {% for node in nodes %}
                <div class="detail-item">
                    <strong>{{ node.id }}</strong> — Type: {{ node.type }}
                    {% if node.text %}<br><em>{{ node.text }}</em>{% endif %}
                </div>
            {% empty %}
                <p>No nodes found.</p>
            {% endfor %}

            <h3>Edges</h3>
            {% for edge in edges %}
                <div class="detail-item">
                    <strong>Edge {{ edge.id }}:</strong> {{ edge.from_node.id }} → {{ edge.to_node.id }} (Weight: {{ edge.weight }})
                </div>
            {% empty %}
                <p>No edges found.</p>
            {% endfor %}
        </section>

        <div class="back-link-container">
            <a href="{% url 'main:graphs_list' %}">← Back to graphs list</a>
        </div>
    </div>
</div>

<!-- Hidden div to pass graph data from Django to JavaScript  / Suggested by GPT -->
<div id="graph-data" 
     data-nodes='[
        {% for node in nodes %}
        {"id": "{{ node.id }}", "type": "{{ node.type }}", "label": "{{ node.type|title }}", "text": "{{ node.text|escapejs }}"}{% if not forloop.last %},{% endif %}
        {% endfor %}
     ]'
     data-edges='[
        {% for edge in edges %}
        {"source": "{{ edge.from_node.id }}", "target": "{{ edge.to_node.id }}"}{% if not forloop.last %},{% endif %}
        {% endfor %}
     ]'>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/nlpgraph.js' %}"></script>
<script src="{% static 'js/graph_detail.js' %}"></script>
{% endblock %}